<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>pandas_tidy_data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="06_Pandas_Tidy_Data_files/libs/clipboard/clipboard.min.js"></script>
<script src="06_Pandas_Tidy_Data_files/libs/quarto-html/quarto.js"></script>
<script src="06_Pandas_Tidy_Data_files/libs/quarto-html/popper.min.js"></script>
<script src="06_Pandas_Tidy_Data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="06_Pandas_Tidy_Data_files/libs/quarto-html/anchor.min.js"></script>
<link href="06_Pandas_Tidy_Data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="06_Pandas_Tidy_Data_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="06_Pandas_Tidy_Data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="06_Pandas_Tidy_Data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="06_Pandas_Tidy_Data_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<table class="caption-top">
<thead>
<tr class="header">
<th><a href="04_Pandas_Basics.md">Pandas Basics</a></th>
<th><a href="05_Pandas_Clean_Data.md">Clean Data</a></th>
<th><strong>Tidy Data</strong></th>
<th><a href="07_Pandas_Filter_Find_Group.md">Filtering, Finding, and Grouping</a></th>
<th><a href="08_Pandas_Graphs_and_Charts.md">Graphs and Charts</a></th>
<th><a href="09_Pandas_Networks.md">Networks</a></th>
</tr>
</thead>

</table>
<section id="pandas-tidy-data" class="level1">
<h1>Pandas: Tidy Data</h1>
<p>In this tutorial, we explore ways to make your data follow “Tidy Data” principles, which will vastly simplify other work. The key concept of Tidy Data is “one observation or event per row”.</p>
<p>Read the official Pandas <a href="https://pandas.pydata.org/about/">documentation</a>.</p>
<p>Find tutorials at <a href="https://www.w3schools.com/python/pandas/default.asp">W3Schools</a>.</p>
<p>A helpful <a href="https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf">Pandas Cheat Sheet</a>.</p>
<p>Read the famous <a href="https://www.jstatsoft.org/article/view/v059i10">essay on Tidy Data</a>.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Contents of this Tutorial</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.</td>
<td><a href="#data-organization-principles"><strong>Data Organization Principles</strong></a></td>
</tr>
<tr class="even">
<td>2.</td>
<td><a href="#fixing-multiple-variables-in-one-column"><strong>Fixing Multiple Variables in One Column</strong></a></td>
</tr>
<tr class="odd">
<td>3.</td>
<td><a href="#fixing-multiple-observations-in-one-row-explode"><strong>Fixing Multiple Observations in One Row: Explode</strong></a></td>
</tr>
<tr class="even">
<td>4.</td>
<td><a href="#fixing-multiple-observations-in-one-row-melt"><strong>Fixing Multiple Observations in One Row: Melt</strong></a></td>
</tr>
<tr class="odd">
<td>5.</td>
<td><a href="#tuple-trouble-and-how-to-cure-it"><strong>Tuple Trouble (and How to Cure It)</strong></a></td>
</tr>
<tr class="even">
<td>6.</td>
<td><a href="#combining-columns"><strong>Combining Columns</strong></a></td>
</tr>
<tr class="odd">
<td>7.</td>
<td><a href="#stack-and-unstack"><strong>Stack and Unstack</strong></a></td>
</tr>
</tbody>
</table>
<section id="we-continue-with-our-data-about-the-beatles" class="level3">
<h3 class="anchored" data-anchor-id="we-continue-with-our-data-about-the-beatles">We continue with our data about The Beatles:</h3>
<ul>
<li><p>A set from <strong>Spotify</strong> that includes information about 193 songs, albums, years, plus other acoustic ratings that Spotify uses to characterize tracks. View these data as a <a href="https://github.com/RichardFreedman/Encoding_Music/blob/main/02_Lab_Data/Beatles/M_255_Beatles_Spotify_2025.csv">Github</a>.</p></li>
<li><p>A set compiled by a team at the <strong>University of Belgrade (Serbia)</strong> that contains information about over 300 Beatles songs: author(s), lead singer(s), album, musical genre(s), and standing in the Top 50 Billboard charts. View these data on <a href="'https://github.com/inteligentni/Class-05-Feature-engineering/blob/master/The%20Beatles%20songs%20dataset%2C%20v1%2C%20no%20NAs.csv'">Github</a>.</p></li>
</ul>
<p>We will work with both of these sets, and in the process learn how to clean and ‘tidy’ the data in preparation for other operations.</p>
<p>Get the Spotify data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>beatles_spotify_csv <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/RichardFreedman/Encoding_Music/refs/heads/main/02_Lab_Data/Billboard%20and%20Spotify%20Data/Beatles_Spotify.csv'</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>beatles_spotify <span class="op">=</span> pd.read_csv(beatles_spotify_csv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and the Billboard data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>beatles_billboard_csv <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/inteligentni/Class-05-Feature-engineering/master/The%20Beatles</span><span class="sc">%20s</span><span class="st">ongs</span><span class="sc">%20d</span><span class="st">ataset%2C%20v1%2C%20no%20NAs.csv'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>beatles_billboard <span class="op">=</span> pd.read_csv(beatles_billboard_csv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can combine them with <code>pd.merge()</code></p>
</section>
<section id="data-organization-principles" class="level2">
<h2 class="anchored" data-anchor-id="data-organization-principles">Data Organization Principles</h2>
<p>The next step to take with your data is making it <strong>tidy</strong>. The key concepts of Tidy Data are:</p>
<ol type="1">
<li><p>Each variable forms a column</p>
<blockquote class="blockquote">
<p>In our <code>beatles_billboard</code> dataset, the <code>'Album.debut'</code> column contains <em>two</em> variables: the UK and the US release of each album. To fix this, we would have to create two columns, one for the UK release and one for the US release.</p>
</blockquote>
<p>As you will see in <a href="#fixing-multiple-variables-in-one-column">Fixing Multiple Variables in One Column</a>, the <code>.str.split()</code> method is a great way to solve this.</p></li>
<li><p>Each observation forms a row</p>
<blockquote class="blockquote">
<p>In the <code>beatles_billboard</code> dataset, the <code>'Genre'</code> column often contains <em>several</em> genres. This is, in effect <em>several observations</em>. Tidy data would suggest creating a new row for each observation.</p>
</blockquote>
<p>As you will see in <a href="#fixing-multiple-observations-in-one-row-explode">Fixing Multiple Observations in One Row</a>, the <code>.explode()</code> method is a great way to solve this.</p></li>
<li><p>Each type of observational unit forms a table</p>
<blockquote class="blockquote">
<p>Both <code>beatles_billboard</code> and <code>beatles_spotify</code> center around the observational unit of a <em>single song</em>. If we wanted to focus on a different unit, like observations about musical artists, it would be more organized to do so in a <em>new</em> dataframe, rather than our existing ones.</p>
</blockquote>
<p>In this course, we will largely work with the same type of data during a project, so this point is somewhat beyond our scope. However, even the distinction between the <code>beatles_spotify</code> and <code>beatles_billboard</code> datasets is a good example of separating tables that are making different observations.</p></li>
</ol>
<p>You can read more in Hadley Wickham’s paper on Tidy Data <a href="https://www.jstatsoft.org/article/view/v059i10">here</a>.</p>
<section id="what-are-the-benefits-of-following-tidy-data-principles" class="level3">
<h3 class="anchored" data-anchor-id="what-are-the-benefits-of-following-tidy-data-principles">What are the benefits of following Tidy Data principles?</h3>
<p>Beyond having a largely standardized format for datasets, making your data “tidy” will massively simplify your work in Pandas. In <a href="07_Pandas_Filter_Find_Group.md">Pandas: Filtering, Finding, and Grouping</a>, you’ll start working with your data in-depth. All of Pandas built-in tools to parse, analyze, and visualize your data will work best when your data is organized following these principles.</p>
</section>
</section>
<section id="fixing-multiple-variables-in-one-column" class="level2">
<h2 class="anchored" data-anchor-id="fixing-multiple-variables-in-one-column">Fixing Multiple Variables in One Column</h2>
<p>As observed in the above section, many entries in the <code>'Album.debut'</code> column seem to contain <em>two</em> variables: the <strong>UK</strong> album debut and the <strong>US</strong> album debut, like below:</p>
<table border="1">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
Title
</th>
<th>
Year
</th>
<th>
Album.debut
</th>
<th>
Duration
</th>
<th>
Other.releases
</th>
<th>
Genre
</th>
<th>
Songwriter
</th>
<th>
Lead.vocal
</th>
<th>
Top.50.Billboard
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
9
</th>
<td>
All My Loving
</td>
<td>
1963
</td>
<td>
UK: With the Beatles US: Meet The Beatles!
</td>
<td>
124
</td>
<td>
32
</td>
<td>
Pop/Rock
</td>
<td>
McCartney
</td>
<td>
McCartney
</td>
<td>
-1
</td>
</tr>
</tbody>
</table>
<p>This violates the Tidy Data principle that <strong>“Each variable forms a column”</strong>, since the two variables (UK album release and US album release) are stored in the same column. There are also rows where there is no dinstinction between a UK and a US album release, so we can assume the release was the same in both regions.</p>
<p>This is a somewhat complex problem to solve. The data we need is stored in a string, with part of it coming after “UK:” (the UK release) and part of it coming after “US:” (the US release). Thankfully, there is a string method we can use to tidy data: <code>.str.split()</code>. We know the UK release will always be before ” US: “, and the US after. So we can split on that string (including the spaces before and after): <code>beatles_billboard['Album.debut'].str.split(' US: ')</code></p>
<p>This doesn’t create a new column! To split a column, you can use the <code>expand</code> keyword for the <code>.str.split()</code> method. And since this splits the entry into two columns, we need to assign it to two columns. Put it together below:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>beatles_billboard[[<span class="st">'Album.debut.UK'</span>, <span class="st">'Album.debut.US'</span>]] <span class="op">=</span> beatles_billboard[<span class="st">'Album.debut'</span>].<span class="bu">str</span>.split(<span class="st">' US: '</span>, expand<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then drop the original column, and reorder the columns:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>beatles_billboard <span class="op">=</span> beatles_billboard.drop(columns<span class="op">=</span>[<span class="st">'Album.debut'</span>])</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>beatles_billboard <span class="op">=</span> beatles_billboard.iloc[:, [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You’re left with most of the data in the right place, but you still have a bit of cleaning up to do. You need to deal with the text “UK:”:</p>
<table border="1">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
Title
</th>
<th>
Year
</th>
<th>
Album.debut.UK
</th>
<th>
Album.debut.US
</th>
<th>
Duration
</th>
<th>
Other.releases
</th>
<th>
Genre
</th>
<th>
Songwriter
</th>
<th>
Lead.vocal
</th>
<th>
Top.50.Billboard
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
9
</th>
<td>
All My Loving
</td>
<td>
1963
</td>
<td>
UK: With the Beatles
</td>
<td>
Meet The Beatles!
</td>
<td>
124
</td>
<td>
32
</td>
<td>
Pop/Rock
</td>
<td>
McCartney
</td>
<td>
McCartney
</td>
<td>
-1
</td>
</tr>
</tbody>
</table>
<p>Let’s use another string method, this time <code>.str.strip()</code>, to cut “UK:” out from the beginning of each entry in the column:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>beatles_billboard[<span class="st">'Album.debut.UK'</span>] <span class="op">=</span> beatles_billboard[<span class="st">'Album.debut.UK'</span>].<span class="bu">str</span>.strip(<span class="st">'UK: '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now you’re almost done with the split!</p>
<table border="1">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
Title
</th>
<th>
Year
</th>
<th>
Album.debut.UK
</th>
<th>
Album.debut.US
</th>
<th>
Duration
</th>
<th>
Other.releases
</th>
<th>
Genre
</th>
<th>
Songwriter
</th>
<th>
Lead.vocal
</th>
<th>
Top.50.Billboard
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
9
</th>
<td>
All My Loving
</td>
<td>
1963
</td>
<td>
With the Beatles
</td>
<td>
Meet The Beatles!
</td>
<td>
124
</td>
<td>
32
</td>
<td>
Pop/Rock
</td>
<td>
McCartney
</td>
<td>
McCartney
</td>
<td>
-1
</td>
</tr>
</tbody>
</table>
<p>The last case to handle is albums that didn’t specifiy separate UK/US releases. In those rows, <code>.str.split(' US: ')</code> couldn’t find the string ” US: ” to split on, so it just put the entire string in the <code>'Album.debut.UK'</code> column, and nulls in the <code>'Album.debut.US'</code> column, like so:</p>
<table border="1">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
Title
</th>
<th>
Year
</th>
<th>
Album.debut.UK
</th>
<th>
Album.debut.US
</th>
<th>
…
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
92
</th>
<td>
Help!
</td>
<td>
1963
</td>
<td>
Help!
</td>
<td>
None
</td>
<td>
…
</td>
</tr>
</tbody>
</table>
<p>Remember, <code>None</code>, is another type of missing data. We can fix this using <code>.fillna()</code> to replace any missing data in the <code>'Album.debut.US'</code> column with the entry in the <code>'Album.debut.UK'</code> column for that row:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>beatles_billboard[<span class="st">'Album.debut.US'</span>] <span class="op">=</span> beatles_billboard[<span class="st">'Album.debut.US'</span>].fillna(beatles_billboard[<span class="st">'Album.debut.US'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now every song will be correctly split into two columns:</p>
<table border="1">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
Title
</th>
<th>
Year
</th>
<th>
Album.debut.UK
</th>
<th>
Album.debut.US
</th>
<th>
…
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
92
</th>
<td>
Help!
</td>
<td>
1963
</td>
<td>
Help!
</td>
<td>
Help!
</td>
<td>
…
</td>
</tr>
</tbody>
</table>
<p>If you have any problems, you may need to handle the missing data in the <code>'Album.debut'</code> column before trying to perform operations on it.</p>
</section>
<section id="fixing-multiple-observations-in-one-row-explode-vs-melt" class="level2">
<h2 class="anchored" data-anchor-id="fixing-multiple-observations-in-one-row-explode-vs-melt">Fixing Multiple Observations in One Row: <strong><code>explode</code></strong> vs <strong><code>melt</code></strong></h2>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 41%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th><strong><code>explode()</code></strong></th>
<th><strong><code>melt()</code></strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Function</strong></td>
<td>Splits <strong>list-like values</strong> in rows into multiple rows</td>
<td>“Unpivots” <strong>columns</strong> into rows</td>
</tr>
<tr class="even">
<td><strong>Transformation</strong></td>
<td>List → Rows</td>
<td>Wide (columns) → Long (rows)</td>
</tr>
<tr class="odd">
<td><strong>Operates on</strong></td>
<td>A single column with list, tuple, or array values</td>
<td>Multiple columns</td>
</tr>
<tr class="even">
<td><strong>Input</strong></td>
<td><strong>Column:</strong> <code>genres = ['rock', 'pop']</code></td>
<td><strong>Columns:</strong> <code>danceability</code>, <code>energy</code>, <code>valence</code>, …</td>
</tr>
<tr class="odd">
<td><strong>Code</strong></td>
<td><code>df.explode('genres')</code></td>
<td><code>pd.melt(df, id_vars=[...], value_vars=[...])</code></td>
</tr>
<tr class="even">
<td><strong>Useful for</strong></td>
<td>Filtering, grouping, or joining on individual list items</td>
<td>Grouping by variable, <strong>plotting!</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="fixing-multiple-observations-in-one-row-explode" class="level2">
<h2 class="anchored" data-anchor-id="fixing-multiple-observations-in-one-row-explode">Fixing Multiple Observations in One Row: <code>explode</code></h2>
<p>In the <code>'Genre'</code> column of the <code>beatles_billboard</code> dataset, there are often several genres listed. We can see this in Golden Slumbers:</p>
<table border="1">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
Title
</th>
<th>
Year
</th>
<th>
Album.debut
</th>
<th>
Duration
</th>
<th>
Other.releases
</th>
<th>
Genre
</th>
<th>
Songwriter
</th>
<th>
Lead.vocal
</th>
<th>
Top.50.Billboard
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
81
</th>
<td>
Golden Slumbers
</td>
<td>
1969
</td>
<td>
Abbey Road
</td>
<td>
91
</td>
<td>
5
</td>
<td>
Rock, Baroque Pop, Pop/Rock
</td>
<td>
McCartney
</td>
<td>
McCartney
</td>
<td>
-1
</td>
</tr>
</tbody>
</table>
<p>This violates the principle of Tidy Data that <strong>“Each observation forms a row”</strong>, since there are multiple observations (Golden Slumbers has genre <strong>X</strong>) in a single row. We want to expand this row into three rows, each with a different observed genre. Pandas allows us to do this in three key steps:</p>
<ol type="1">
<li>Clean the data</li>
</ol>
<blockquote class="blockquote">
<p>This could include</p>
<ul>
<li>Converting all genres to lowercase to ensure uniform formatting</li>
<li>Stripping any superfluous spaces</li>
</ul>
<p>This <strong>must</strong> include:</p>
<ul>
<li>Handling any missing data</li>
</ul>
</blockquote>
<ol start="2" type="1">
<li>Within the column, <strong>“split”</strong> the genres:</li>
</ol>
<blockquote class="blockquote">
<table>
<tbody><tr>
<td>
<table>
<tbody><tr>
<th>
Genre
</th>
</tr>
<tr><td>
<code>‘Rock, Baroque Pop, Pop/Rock’</code>
</td>
</tr><tr>
</tr></tbody></table>
</td>
<td>
<strong>→</strong>
</td>
<td>
<table>
<tbody><tr>
<th>
Genre
</th>
</tr>
<tr><td>
<code>[‘Rock’, ‘Baroque Pop’, ‘Pop/Rock’]</code>
</td>
</tr><tr>
</tr></tbody></table>
</td>
</tr>
</tbody></table>
</blockquote>
<ol start="3" type="1">
<li><strong>“Explode”</strong> the row into one row for each genre:</li>
</ol>
<blockquote class="blockquote">
<table>
<tbody><tr>
<td>
<table>
<tbody><tr>
<th>
Genre
</th>
</tr>
<tr><td>
<code>[‘Rock’, ‘Baroque Pop’, ‘Pop/Rock’]</code>
</td>
</tr><tr>
</tr></tbody></table>
</td>
<td>
<strong>→</strong>
</td>
<td>
<table>
<tbody><tr>
<th>
Genre
</th>
</tr>
<tr><td>
<code>‘Rock’</code>
</td>
</tr><tr>
</tr>
<tr><td>
<code>‘Baroque Pop’</code>
</td>
</tr><tr>
</tr>
<tr><td>
<code>‘Pop/Rock’</code>
</td>
</tr><tr>
</tr></tbody></table>
</td>
</tr>
</tbody></table>
</blockquote>
<section id="cleaning-the-data" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-the-data">Cleaning the data</h3>
<p>Since we are already familiar with these steps, let’s clean the column by “chaining” three methods:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make everything lowercase, remove leading/trailing spaces, and fill NAs</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>beatles_billboard[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard[<span class="st">'Genre'</span>].<span class="bu">str</span>.lower().<span class="bu">str</span>.strip().fillna(<span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="splitting-the-data" class="level3">
<h3 class="anchored" data-anchor-id="splitting-the-data">Splitting the data</h3>
<p>To split the genres into an organized <strong>list</strong>, we use the string method <code>.str.split(', ')</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split the long strings into a list of strings in each cell</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>beatles_billboard[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard[<span class="st">'Genre'</span>].<span class="bu">str</span>.split(<span class="st">', '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="exploding-the-data" class="level3">
<h3 class="anchored" data-anchor-id="exploding-the-data">Exploding the data</h3>
<p>Now we can split the row into several rows, one for each element of the list, using <code>df.explode('column_name')</code>, in this case <code>beatles_billboard.explode('Genre')</code>. Since this is such a big change, and we don’t want to ruin our data, let’s store the result in a new dataframe, <code>beatles_billboard_exploded</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># explode the data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded <span class="op">=</span> beatles_billboard.explode(<span class="st">'Genre'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>“Exploded” rows maintain their original dataframe index. For example, since Golden Slumbers had the index <code>81</code>, and three genres, there are now three rows with the index <code>81</code>. Let’s fix this using <code>.reset_index(drop=True)</code> (this removes the old index column):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up indices</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded <span class="op">=</span> beatles_billboard_exploded.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now the entries for Golden Slumbers will have unique indices:</p>
<table border="1">
<thead>
<tr>
<th>
</th>
<th>
Title
</th>
<th>
Year
</th>
<th>
Album.debut
</th>
<th>
Duration
</th>
<th>
Other.releases
</th>
<th>
Genre
</th>
<th>
Songwriter
</th>
<th>
Lead.vocal
</th>
<th>
Top.50.Billboard
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
154
</th>
<td>
Golden Slumbers
</td>
<td>
1969
</td>
<td>
Abbey Road
</td>
<td>
91
</td>
<td>
5
</td>
<td>
rock
</td>
<td>
McCartney
</td>
<td>
McCartney
</td>
<td>
-1
</td>
</tr>
<tr>
<th>
155
</th>
<td>
Golden Slumbers
</td>
<td>
1969
</td>
<td>
Abbey Road
</td>
<td>
91
</td>
<td>
5
</td>
<td>
baroque pop
</td>
<td>
McCartney
</td>
<td>
McCartney
</td>
<td>
-1
</td>
</tr>
<tr>
<th>
156
</th>
<td>
Golden Slumbers
</td>
<td>
1969
</td>
<td>
Abbey Road
</td>
<td>
91
</td>
<td>
5
</td>
<td>
pop/rock
</td>
<td>
McCartney
</td>
<td>
McCartney
</td>
<td>
-1
</td>
</tr>
</tbody>
</table>
<p>Remember you can chain methods in one line once you’re comfortable with them, like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded <span class="op">=</span> beatles_billboard.explode(<span class="st">'Genre'</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this way, you can more simply write all of the steps for exploding:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>beatles_billboard[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard[<span class="st">'Genre'</span>].<span class="bu">str</span>.lower().<span class="bu">str</span>.strip().fillna(<span class="st">''</span>).<span class="bu">str</span>.split(<span class="st">', '</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded <span class="op">=</span> beatles_billboard.explode(<span class="st">'Genre'</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="clean-the-result" class="level3">
<h3 class="anchored" data-anchor-id="clean-the-result">Clean the result</h3>
<p>You can now more easily access the individual genres, which you will need to clean using string methods like <code>.str.replace()</code>.</p>
<p>The below code snippet provides an example of the methods you could apply in this scenario.</p>
<details>
<summary>
View code
</summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean individual problems in the exploded data with str.replace() and str.strip()</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard_exploded[<span class="st">'Genre'</span>].<span class="bu">str</span>.strip(<span class="st">'['</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard_exploded[<span class="st">'Genre'</span>].<span class="bu">str</span>.replace(<span class="st">'pop/rock'</span>, <span class="st">'pop rock'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard_exploded[<span class="st">'Genre'</span>].<span class="bu">str</span>.replace(<span class="st">'r&amp;b'</span>, <span class="st">'rhythm and blues'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard_exploded[<span class="st">'Genre'</span>].<span class="bu">str</span>.replace(<span class="st">'rock and roll'</span>, <span class="st">'rock'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard_exploded[<span class="st">'Genre'</span>].<span class="bu">str</span>.replace(<span class="st">'experimental music'</span>, <span class="st">'experimental'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard_exploded[<span class="st">'Genre'</span>].<span class="bu">str</span>.replace(<span class="st">"children's music"</span>, <span class="st">"children's"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>beatles_billboard_exploded[<span class="st">'Genre'</span>] <span class="op">=</span> beatles_billboard_exploded[<span class="st">'Genre'</span>].<span class="bu">str</span>.replace(<span class="st">"stage&amp;screen"</span>, <span class="st">"stage and screen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>You’ll see an example of this in the <a href="09_Pandas_Networks.md">Networks tutorial</a>.</p>
</section>
</section>
<section id="fixing-multiple-observations-in-one-row-melt" class="level2">
<h2 class="anchored" data-anchor-id="fixing-multiple-observations-in-one-row-melt">Fixing Multiple Observations in One Row: melt</h2>
<p>So, what is melt? Let’s take the <code>beatles_spotify</code> dataset. It contains audio features — <code>danceability</code>, <code>energy</code>, <code>valence</code>, etc. — spread across separate columns:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 16%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>song</th>
<th>danceability</th>
<th>energy</th>
<th>speechiness</th>
<th>acousticness</th>
<th>liveness</th>
<th>valence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>yesterday</td>
<td>0.3320</td>
<td>0.1790</td>
<td>0.0326</td>
<td>0.8790</td>
<td>0.0886</td>
<td>0.3150</td>
</tr>
</tbody>
</table>
<p>Many visualization libraries (especially Plotly, which we will be working with frequently) work better with <strong>long-format</strong> data, where each row represents a single feature measurement. This is what our data should look like:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>song</th>
<th>variable</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>yesterday</td>
<td>danceability</td>
<td>0.3320</td>
</tr>
<tr class="even">
<td>yesterday</td>
<td>energy</td>
<td>0.1790</td>
</tr>
<tr class="odd">
<td>yesterday</td>
<td>speechiness</td>
<td>0.0326</td>
</tr>
<tr class="even">
<td>yesterday</td>
<td>acousticness</td>
<td>0.8790</td>
</tr>
<tr class="odd">
<td>yesterday</td>
<td>liveness</td>
<td>0.0886</td>
</tr>
<tr class="even">
<td>yesterday</td>
<td>valence</td>
<td>0.3150</td>
</tr>
</tbody>
</table>
<hr>
<p>This is where the Pandas <code>.melt()</code> method comes in. We can pass <code>.melt()</code> our dataframe, the column(s) that differentiate each row (<code>id_vars</code>), and the columns we want to be “melted” (<code>value_vars</code>).</p>
<p>This will create a new table, which we can save separately, and will only contain the information we have specifically passed to the .melt() method.</p>
<section id="basic-syntax" class="level4">
<h4 class="anchored" data-anchor-id="basic-syntax">Basic syntax:</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pd.melt(dataframe, id_vars<span class="op">=</span>..., value_vars<span class="op">=</span>...) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-melting-beatles_spotify" class="level4">
<h4 class="anchored" data-anchor-id="example-melting-beatles_spotify">Example: Melting <code>beatles_spotify</code></h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose our ID Vars, or identifiers - the column to keep fixed</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>id_vars <span class="op">=</span> [<span class="st">'song'</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose our value_vars, or columns to "unpivot" into a single "variable" column.</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>value_vars <span class="op">=</span> [<span class="st">'danceability'</span>, <span class="st">'energy'</span>, <span class="st">'speechiness'</span>, <span class="st">'acousticness'</span>, <span class="st">'liveness'</span>, <span class="st">'valence'</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Using melt</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>melted_feature_data <span class="op">=</span> pd.melt(</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    beatles_spotify, <span class="co"># Dataset</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>id_vars, <span class="co"># Pivot</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    value_vars<span class="op">=</span>value_vars <span class="co"># Values</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>).sort_values(<span class="st">'song'</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>) <span class="co"># Sorting</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Resulting Table:</strong></p>
<table border="1">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
song
</th>
<th>
variable
</th>
<th>
value
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
1110
</th>
<td>
yesterday
</td>
<td>
valence
</td>
<td>
0.3150
</td>
</tr>
<tr>
<th>
1111
</th>
<td>
yesterday
</td>
<td>
liveness
</td>
<td>
0.0886
</td>
</tr>
<tr>
<th>
1112
</th>
<td>
yesterday
</td>
<td>
acousticness
</td>
<td>
0.8790
</td>
</tr>
<tr>
<th>
1113
</th>
<td>
yesterday
</td>
<td>
energy
</td>
<td>
0.1790
</td>
</tr>
<tr>
<th>
1114
</th>
<td>
yesterday
</td>
<td>
speechiness
</td>
<td>
0.0326
</td>
</tr>
<tr>
<th>
1115
</th>
<td>
yesterday
</td>
<td>
danceability
</td>
<td>
0.3320
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="tuple-trouble-and-how-to-cure-it" class="level2">
<h2 class="anchored" data-anchor-id="tuple-trouble-and-how-to-cure-it">Tuple Trouble (and How to Cure It)</h2>
<p>You may encounter data stored as tuples: <code>('this', 'is', 'a', 'tuple')</code>. As we’ve seen, it can be much easier to work with strings than tuples (for example, for the functionality of string methods). This function will help you convert tuples to strings:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the function to convert tuples to strings</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convertTuple(tup):</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> <span class="st">""</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(tup, <span class="bu">tuple</span>):</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> <span class="st">'_'</span>.join(tup)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out  </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># clean the tuples</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'column_name'</span>] <span class="op">=</span> df[<span class="st">'column_name'</span>].<span class="bu">apply</span>(convertTuple)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="combining-columns" class="level2">
<h2 class="anchored" data-anchor-id="combining-columns">Combining Columns</h2>
<p>As we’ve seen, making your data tidy can involve splitting a column into several columns. However, you may also want to combine several columns of related data into one. For example, you could take the <code>'Songwriter'</code> and <code>'Title'</code> columns from <code>beatles_billboard</code>, and combine them into a new <code>'Author-Title'</code> column with the format <code>'Songwriter: Title'</code>. This function will help you do that:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the function using lambda</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>combine_cols <span class="op">=</span> <span class="kw">lambda</span> row: row[<span class="st">'Songwriter'</span>] <span class="op">+</span> <span class="st">": "</span>  <span class="op">+</span> row[<span class="st">'Title'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use .apply() to apply the function to every row in the column</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>beatles_billboard[<span class="st">'Author-Title'</span>] <span class="op">=</span> beatles_billboard.<span class="bu">apply</span>(combine_cols, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># output a single row as an example</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>beatles_billboard[<span class="st">'Author-Title'</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table border="0">
<tbody><tr>
<th valign="top">
Output:
</th>
<td>
<pre>'Lennon, McCartney, Harrison and Starkey: 12-Bar Original'</pre>
</td>
</tr>
</tbody></table>
<blockquote class="blockquote">
<p>Normally we’ve seen functions written like this: <code>def combine_cols(row):</code>. However, there is a shorthand for writing functions using <code>lambda</code>, which allows you to write functions in a single line. <code>lambda</code> functions are easier and cleaner to write, but at the expense of readbility. Learn more <a href="https://www.w3schools.com/python/python_lambda.asp">here</a>.</p>
</blockquote>
</section>
<section id="stack-and-unstack" class="level2">
<h2 class="anchored" data-anchor-id="stack-and-unstack">Stack and Unstack</h2>
<p><code>stack</code> and <code>unstack</code> provide new ways to reshape your data. They are more radical transformations than <code>explode</code> and <code>melt</code> because the result isn’t necessarily a dataframe. While you are less likely to need these methods, you may encounter scenarios, such as a visualization tool requiring a specific data format, where they are beneficial. As such, the primary focus of this section is to expand your knowledge of the possibilities without delving into the specifics.</p>
<section id="stack-function" class="level3">
<h3 class="anchored" data-anchor-id="stack-function"><code>stack</code> Function</h3>
<p><code>stack</code> transforms your dataframe into a series. Each entry in the series represents a row in the original dataframe. You can think of this as converting your data from a “wide” format to a “long” format. For example:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>stacked_df <span class="op">=</span> beatles_billboard.stack()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># show the first entry</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table border="0">
<tbody><tr>
<th valign="top">
Output:
</th>
<td>
<pre>Title                                       12-Bar Original
Year                                                   1965
Album.debut                                     Anthology 2
Duration                                                174
Other.releases                                            0
Genre                                                 Blues
Songwriter          Lennon, McCartney, Harrison and Starkey
Top.50.Billboard                                         -1
dtype: object</pre>
</td>
</tr>
</tbody></table>
<p>One common way to <code>stack</code> dataframes is by first setting the index to one of the columns of the dataframe. That way, the resulting series has each title as an index, making it easy to quickly see information on a particular track.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a stack with titles as indices</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>title_stack <span class="op">=</span> beatles_billboard.set_index(<span class="st">'Title'</span>).stack()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># show the result</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>title_stack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table border="0">
<tbody><tr>
<th valign="top">
Output:
</th>
<td>
<pre style="white-space: pre;">Title                                                                      
12-Bar Original                                            Year                                                             1965
                                                           Album.debut                                               Anthology 2
                                                           Duration                                                          174
                                                           Other.releases                                                      0
                                                           Genre                                                           Blues
                                                           Songwriter                    Lennon, McCartney, Harrison and Starkey
                                                           Top.50.Billboard                                                   -1
A Day in the Life                                          Year                                                             1967
                                                           Album.debut                     Sgt. Pepper's Lonely Hearts Club Band
                                                           Duration                                                          335
                                                           Other.releases                                                     12
                                                           Genre                            Psychedelic Rock, Art Rock, Pop/Rock
                                                           Songwriter                                       Lennon and McCartney
                                                           Lead.vocal                                       Lennon and McCartney
                                                           Top.50.Billboard                                                   -1
...</pre>
</td>
</tr>
</tbody></table>
<p>This makes it much more intuitive to access information for a single track:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>title_stack[<span class="st">'A Day in the Life'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table border="0">
<tbody><tr>
<th valign="top">
Output:
</th>
<td>
<pre style="white-space: pre;">Year                                                 1967
Album.debut         Sgt. Pepper's Lonely Hearts Club Band
Duration                                              335
Other.releases                                         12
Genre                Psychedelic Rock, Art Rock, Pop/Rock
Songwriter                           Lennon and McCartney
Lead.vocal                           Lennon and McCartney
Top.50.Billboard                                       -1
dtype: object</pre>
</td>
</tr>
</tbody></table>
<p>You can also reference just a specific data point:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>title_stack[<span class="st">'A Day in the Life'</span>][<span class="st">'Lead.vocal'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table border="0">
<tbody><tr>
<th valign="top">
Output:
</th>
<td>
<pre style="white-space: pre;">'Lennon and McCartney'</pre>
</td>
</tr>
</tbody></table>
<p>Use this code to check all of the possible index values:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>(title_stack.index.get_level_values(<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="unstack-function" class="level3">
<h3 class="anchored" data-anchor-id="unstack-function"><code>unstack</code> Function</h3>
<p><code>unstack</code> is the inverse operation of <code>stack</code>.</p>
<p>The one crucial requirement for a successful <code>unstack</code> operation is that each index in the “stacked” (long form) data is unique. If it isn’t, this should be resolved using <code>.drop_duplicates()</code>, <code>.reset_index()</code>, <code>.reset_index(drop=True)</code>, or another method, depending on your needs.</p>
<p>If each index in your stacked data is unique, you can simply use the <code>.unstack()</code> method to re-create the original dataframe, as it was before the <code>stack</code> was performed.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>reverted_df <span class="op">=</span> stacked_df.unstack()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="caption-top">
<thead>
<tr class="header">
<th><a href="04_Pandas_Basics.md">Pandas Basics</a></th>
<th><a href="05_Pandas_Clean_Data.md">Clean Data</a></th>
<th><strong>Tidy Data</strong></th>
<th><a href="07_Pandas_Filter_Find_Group.md">Filtering, Finding, and Grouping</a></th>
<th><a href="08_Pandas_Graphs_and_Charts.md">Graphs and Charts</a></th>
<th><a href="09_Pandas_Networks.md">Networks</a></th>
</tr>
</thead>

</table>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>